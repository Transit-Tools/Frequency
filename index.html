<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>GTFS Frequency</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
</head>

<body>
  <div class="wrap">
    <header>
      <h1><a href="index.html" class="headerTitleLink"><strong>GTFS</strong> <span
            style="font-weight:400">Frequency</span></a></h1>
      <div class="headerActions">
        <button id="exportBtn" class="btn btnAction" style="display:none" onclick="exportResults()">Export</button>
        <button id="theme" class="btn btnTheme" type="button" title="Toggle theme">üåô</button>
        <button id="timeSettingsBtn" class="btn btnTheme" type="button" title="Time filter settings"
          onclick="openTimeSettings()">‚öôÔ∏è</button>
      </div>
    </header>
    <!-- Hidden input for file upload (triggered by Landing Page button) -->
    <input id="gtfs" type="file" accept=".zip" style="display:none">
    <section id="landingPage">
      <div class="landingHero">
        <h2>Analyze Transit Frequency in Seconds</h2>
        <p>Local, private, and instant GTFS analysis tool.</p>

        <label for="gtfs" class="bigUploadBtn">
          <span>üìÇ</span> Upload GTFS Zip
        </label>

        <div class="landingFeatures">
          <div class="featureCard">
            <span class="featureIcon">‚ö°Ô∏è</span>
            <div class="featureTitle">Instant Results</div>
            <div class="featureDesc">Drag & drop your GTFS feed to instantly visualize frequency tiers and headways.
            </div>
          </div>
          <div class="featureCard">
            <span class="featureIcon">üîí</span>
            <div class="featureTitle">Privacy First</div>
            <div class="featureDesc">100% local processing. Your data never leaves your browser.</div>
          </div>
          <div class="featureCard">
            <span class="featureIcon">üìä</span>
            <div class="featureTitle">Deep Insights</div>
            <div class="featureDesc">Analyze day-by-day patterns, identify gaps, and export compliance reports.</div>
          </div>
        </div>
      </div>
    </section>


    <section id="controlsPanel" class="panel" style="display:none">
      <div id="rangeMessage" class="rangeMessage" role="status" aria-live="polite"></div>
      <!-- Hidden merge checkbox - default on -->
      <input id="merge" type="checkbox" checked style="display:none">
      <div id="historicalBanner" class="historicalBanner" style="display:none"></div>
      <div id="feedMetadata" class="feedMetaInline" style="display:none;margin-top:8px">
        <span><strong>Feed:</strong> <span id="feedFilename"></span></span>
        <span><strong>Valid:</strong> <span id="feedValidity"></span></span>
        <span><strong>Analyzed:</strong> <span id="analyzedTime"></span></span>
      </div>
    </section>

    <!-- Time filter settings modal -->
    <div id="timeSettingsModal" class="modal" style="display:none">
      <div class="dialog" style="max-width:400px">
        <div class="dialogHeader">
          <h3>Time Filter Settings</h3>
          <button class="close" onclick="closeTimeSettings()">‚úï</button>
        </div>
        <div class="dialogBody">
          <div class="timeRange" style="flex-direction:column;gap:12px">
            <div class="field">
              <label>Start Time</label>
              <input id="t0" type="time" value="07:00">
            </div>
            <div class="field">
              <label>End Time</label>
              <input id="t1" type="time" value="22:00">
            </div>
            <button class="btn" onclick="applyTimeSettings()">Apply & Re-analyze</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Day Pills + Tier Summary Boxes -->
    <section id="tierSummary" class="panel" style="display:none">
      <div class="filterRow">
        <div class="dayPills">
          <button class="dayPill active" data-day="Weekday" type="button">Weekday</button>
          <button class="dayPill" data-day="Saturday" type="button">Saturday</button>
          <button class="dayPill" data-day="Sunday" type="button">Sunday</button>
        </div>
        <div class="tierBoxes">
          <button class="tierBox tier10" data-tier="10" type="button">
            <div class="tierName">FREQ+</div>
            <div class="tierCount">0</div>
          </button>
          <button class="tierBox tier15" data-tier="15" type="button">
            <div class="tierName">FREQ</div>
            <div class="tierCount">0</div>
          </button>
          <button class="tierBox tier20" data-tier="20" type="button">
            <div class="tierName">GOOD</div>
            <div class="tierCount">0</div>
          </button>
          <button class="tierBox tier30" data-tier="30" type="button">
            <div class="tierName">BASIC</div>
            <div class="tierCount">0</div>
          </button>
          <button class="tierBox tier60" data-tier="60" type="button">
            <div class="tierName">INFREQ</div>
            <div class="tierCount">0</div>
          </button>
          <button class="tierBox tierBig" data-tier=">60" type="button">
            <div class="tierName">SPARSE</div>
            <div class="tierCount">0</div>
          </button>
          <button class="tierBox tierSpan" data-tier="span" type="button">
            <div class="tierName">SPAN</div>
            <div class="tierCount">0</div>
          </button>
        </div>
      </div>
      <div class="filterBar">
        <div class="filterMessage">
          Showing all routes for <strong id="sortDayLabel">Weekday</strong> <span id="timeRangeLabel"></span>.
        </div>
        <div class="filterBarRight">
          <div class="search">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
              <path stroke="currentColor" stroke-opacity=".5" stroke-width="2"
                d="m21 21-4.35-4.35M10 18a8 8 0 1 1 0-16 8 8 0 0 1 0 16Z" />
            </svg>
            <input id="q" placeholder="Filter by route name...">
          </div>
          <span class="routeCount">Displaying <strong>0</strong> routes</span>
        </div>
      </div>
    </section>

    <!-- Route List Table -->
    <section id="tableWrap" class="panel" style="display:none">
      <div id="resultsScroll" class="resultsScroll">
        <table id="tbl" class="routeTable">
          <thead>
            <tr>
              <th class="route">ROUTE</th>
              <th class="modeCol">MODE</th>
              <th class="dayCol">WEEKDAY</th>
              <th class="dayCol">SATURDAY</th>
              <th class="dayCol">SUNDAY</th>
              <th class="numCol">TRIPS</th>
              <th class="numCol">BEST</th>
              <th class="numCol">WORST</th>
              <th class="validCol">VALIDATED</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
  </div>

  <!-- Inspect Modal -->
  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="dialog">
      <div class="dialogHeader">
        <div id="modalTitle"></div>
        <button class="close" onclick="closeModal()">‚úï</button>
      </div>
      <div id="modalBody" class="dialogBody"></div>
    </div>
  </div>

  <script src="script.js"></script>
</body>

</html>